{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/cdklabs/awscdk-service-spec/encryption-data-schema.json",
  "title": "AWS CloudFormation Encryption at Rest Configuration",
  "description": "Schema for encryption at rest configuration data extracted from CloudFormation resource schemas",
  "type": "object",
  "required": ["metadata", "resources", "statistics"],
  "properties": {
    "metadata": {
      "type": "object",
      "required": ["extractionDate", "totalResources", "resourcesWithEncryption", "schemaSource"],
      "properties": {
        "extractionDate": {
          "type": "string",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$",
          "description": "ISO-8601 timestamp of when data was extracted"
        },
        "totalResources": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of CloudFormation resources scanned"
        },
        "resourcesWithEncryption": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of resources with encryption properties"
        },
        "schemaSource": {
          "type": "string",
          "description": "Path to CloudFormation schema source directory"
        }
      }
    },
    "resources": {
      "type": "array",
      "description": "Array of resources with encryption configuration",
      "items": {
        "$ref": "#/definitions/Resource"
      }
    },
    "statistics": {
      "type": "object",
      "required": ["byPattern", "byService"],
      "properties": {
        "byPattern": {
          "type": "object",
          "description": "Count of resources by encryption pattern",
          "properties": {
            "boolean_kms": {"type": "integer", "minimum": 0},
            "complex": {"type": "integer", "minimum": 0},
            "kms_only": {"type": "integer", "minimum": 0},
            "other": {"type": "integer", "minimum": 0}
          }
        },
        "byService": {
          "type": "object",
          "description": "Count of resources by AWS service namespace",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        }
      }
    }
  },
  "definitions": {
    "Resource": {
      "type": "object",
      "required": ["cloudFormationType", "schemaFile", "encryptionProperties", "pattern"],
      "properties": {
        "cloudFormationType": {
          "type": "string",
          "pattern": "^AWS::[A-Za-z0-9]+::[A-Za-z0-9]+$",
          "description": "CloudFormation resource type (e.g., AWS::S3::Bucket)",
          "examples": ["AWS::S3::Bucket", "AWS::DynamoDB::Table"]
        },
        "schemaFile": {
          "type": "string",
          "pattern": "^aws-[a-z0-9]+-[a-z0-9]+\\.json$",
          "description": "Source schema filename",
          "examples": ["aws-s3-bucket.json"]
        },
        "encryptionProperties": {
          "type": "array",
          "minItems": 1,
          "description": "Array of encryption-related properties",
          "items": {
            "$ref": "#/definitions/EncryptionProperty"
          }
        },
        "pattern": {
          "type": "string",
          "enum": ["boolean_kms", "complex", "kms_only", "other"],
          "description": "Classification of encryption configuration pattern"
        },
        "defaultBehavior": {
          "type": "string",
          "description": "Description of default encryption behavior"
        }
      }
    },
    "EncryptionProperty": {
      "type": "object",
      "required": ["name", "required", "type"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Property name as it appears in CloudFormation",
          "examples": ["BucketEncryption", "KmsKeyId", "Encrypted"]
        },
        "required": {
          "type": ["boolean", "array"],
          "description": "Whether this property is required in CloudFormation (boolean) or array of required nested properties",
          "items": {
            "type": "string"
          }
        },
        "type": {
          "type": "string",
          "enum": ["primitive", "complex", "array"],
          "description": "Property type classification"
        },
        "primitiveType": {
          "type": ["string", "null"],
          "enum": ["string", "boolean", "integer", "number", "array", "object", null],
          "description": "Primitive type if type is 'primitive', or base type for other classifications"
        },
        "referenceType": {
          "type": "string",
          "description": "Referenced type definition name if type is 'complex'",
          "examples": ["BucketEncryption", "SSESpecification"]
        },
        "description": {
          "type": "string",
          "maxLength": 200,
          "description": "Property description from CloudFormation schema (truncated to 200 chars)"
        },
        "nestedStructure": {
          "type": "object",
          "description": "Nested property structure for complex types",
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    }
  }
}
