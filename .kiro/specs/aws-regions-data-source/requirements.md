# AWS Regions Data Source

## Overview

Add a new data source to the AWS CDK Service Specification that provides information about AWS partitions and regions using the AWS SDK JS v3 partitions.json file.

## User Stories

### 1. As a CDK developer, I want access to AWS partition and region data
**So that** I can generate code that references valid AWS partitions and regions

**Acceptance Criteria:**
- 1.1: A new data source directory exists under `sources/` for AWS partitions
- 1.2: The data source follows the same pattern as existing sources (e.g., StatefulResources, SAMSpec)
- 1.3: The data source includes a README.md explaining its purpose and source
- 1.4: The data source includes the partitions.json file containing partition and region data

### 2. As a maintainer, I want an automated way to update region data
**So that** I can keep the region information current as AWS adds new regions

**Acceptance Criteria:**
- 2.1: A projen task `update-source:aws-partitions` exists to fetch partition/region data
- 2.2: The task downloads from the AWS SDK JS v3 partitions.json URL
- 2.3: The task is added to the `update-sources:all` task
- 2.4: The task is configured in `.projenrc.ts` using `SingleSource`
- 2.5: A GitHub workflow `update-source-aws-partitions.yml` is generated by projen
- 2.6: No AWS authentication is required (public GitHub raw URL)
- 2.7: Usage is documented in the README

### 3. As a user of the spec, I want partition and region data to be well-structured
**So that** I can easily query and use the partition and region information

**Acceptance Criteria:**
- 3.1: The JSON structure is documented
- 3.2: The data includes partitions with their regions, DNS suffix, and other metadata
- 3.3: The data format matches the AWS SDK JS v3 partitions.json schema
- 3.4: The JSON file is properly formatted and validated

### 4. As a developer, I want partition data integrated into service-spec-types
**So that** the database schema includes partition and region information

**Acceptance Criteria:**
- 4.1: TypeScript types are defined for AWS partitions in `@aws-cdk/service-spec-types`
- 4.2: The Partition entity in the database includes regions and metadata
- 4.3: Types are exported from the package index
- 4.4: Types follow the existing patterns (e.g., similar to StatefulResources types)

### 5. As a developer, I want a loader for partition data in service-spec-importers
**So that** the partition data can be loaded and validated

**Acceptance Criteria:**
- 5.1: A loader function exists in `@aws-cdk/service-spec-importers/src/loaders/`
- 5.2: The loader validates the JSON schema
- 5.3: The loader follows the pattern of existing loaders (e.g., `load-stateful-resources.ts`)
- 5.4: A JSON schema file exists for validation in the schemas directory
- 5.5: The loader is exported from the loaders index

### 6. As a developer, I want an importer for partition data in service-spec-importers
**So that** partition data can be imported into the database

**Acceptance Criteria:**
- 6.1: An importer function exists in `@aws-cdk/service-spec-importers/src/importers/`
- 6.2: The importer creates Partition and Region entities in the database
- 6.3: The importer follows the pattern of existing importers (e.g., `import-stateful-resources.ts`)
- 6.4: The importer is integrated into the DatabaseBuilder in `db-builder.ts`
- 6.5: The importer can be called from the import-db CLI tool

### 7. As a developer, I want partition data available in aws-service-spec
**So that** the published database includes partition and region information

**Acceptance Criteria:**
- 7.1: The build process includes the partition data source
- 7.2: The generated database file includes partition and region data
- 7.3: The package documentation mentions the partition data source

## Technical Notes

### Source URL
The partitions data is sourced from the AWS SDK JS v3 repository:
```
https://raw.githubusercontent.com/aws/aws-sdk-js-v3/main/packages/util-endpoints/src/lib/aws/partitions.json
```

### Data Structure
The partitions.json file contains:
- `version`: Schema version
- `partitions`: Array of partition objects, each containing:
  - `id`: Partition identifier (e.g., "aws", "aws-cn", "aws-us-gov")
  - `regionRegex`: Regex pattern for region names
  - `regions`: Map of region names to region metadata
  - `outputs`: DNS suffixes and other partition-level configuration

### Directory Structure
Following the pattern of existing data sources:
```
sources/
  AwsPartitions/
    README.md           # Documentation
    partitions.json     # Partition and region data
.projenrc.ts            # Projen configuration with SingleSource
.github/workflows/
  update-source-aws-partitions.yml  # Generated workflow (no AWS auth needed)
```

### Projen Task Configuration
The update task should be configured in `.projenrc.ts` using `SingleSource`:
```typescript
new SingleSource(repo, {
  name: 'aws-partitions',
  dir: 'sources/AwsPartitions',
  source: 'https://raw.githubusercontent.com/aws/aws-sdk-js-v3/main/packages/util-endpoints/src/lib/aws/partitions.json',
});
```

This will:
1. Create a projen task `update-source:aws-partitions` that downloads the file
2. Add the task to `update-sources:all`
3. Generate a GitHub workflow that creates a PR with updated data on a schedule
4. No AWS authentication required (public GitHub URL)

### Integration Points
- The data source should be listed in the main README.md data sources table
- The update frequency should be specified (suggested: Weekly)
- The loader must be added to `packages/@aws-cdk/service-spec-importers/src/loaders/index.ts`
- The importer must be integrated into `packages/@aws-cdk/service-spec-importers/src/db-builder.ts`
- Types must be added to `packages/@aws-cdk/service-spec-importers/src/types/` for the source schema
- A JSON schema must be created in `packages/@aws-cdk/service-spec-importers/schemas/`

### Package Dependencies
1. **@aws-cdk/service-spec-types**: Define/extend Partition and Region entity types
2. **@aws-cdk/service-spec-importers**: Create loader, importer, and schema validation
3. **@aws-cdk/aws-service-spec**: Include partition data in the published database

### Data Flow
```
sources/AwsPartitions/partitions.json
  ↓ (loaded by)
service-spec-importers/loaders/load-aws-partitions.ts
  ↓ (validated against)
service-spec-importers/schemas/AwsPartitions.schema.json
  ↓ (imported by)
service-spec-importers/importers/import-aws-partitions.ts
  ↓ (creates/updates)
SpecDatabase (Partition and Region entities)
  ↓ (published in)
aws-service-spec package
```

## Out of Scope
- Automatic integration into the CDK code generation pipeline (can be added later)
- Region-specific service availability information (services per region)
- Historical partition/region data or versioning
- Opt-in region status (not available in partitions.json)
